\chapter{ CFD-DEM IMPLEMENTATION IN OPENFOAM} 
\label{chapter5} 

The CFD-DEM solver leverages the OpenFOAM framework to simulate fluid-particle interactions. The core of the implementation focuses on mesh generation, the definition of sediment flow domains, modeling spaces, sediment geometries, and ensuring accurate geometry intersection for computational purposes.\par

\section{Geometry and Meshing}

Mesh generation forms the foundation of the CFD-DEM simulation, as it defines the computational domain and partitions the space into discrete elements for numerical analysis. The backgroundMesh class is responsible for this process, providing flexibility to model sediment-laden flows in complex geometries.\par

\subsection{Sediment involved Flow Domain}

The computational domain represents a flow field interacting with sediment particles, which is a fundamental part of the CFD-DEM coupling. The domain is discretized using the backgroundMesh class, ensuring an adaptable grid resolution. This approach facilitates handling the complex interactions between fluid and sediment aggregates while maintaining computational efficiency.\par

The flow domain is bound by a three-dimensional Cartesian grid defined by:\par

\begin{enumerate}
	\item  \textbf{Bounds}: Specified by meshMin\_ and meshMax\_, which determine the global minimum and maximum coordinates.\par
	\item  \textbf{Resolution}: A scalar value, resolution\_, sets the grid's fineness. This influences the discretization level, balancing accuracy, and computational cost.\par
\end{enumerate}

The \textbf{backgroundMesh} class systematically subdivides the domain into blocks, with each block containing a specific number of cells based on the resolution. The cells in this grid adapt to include sediment geometries through an intersection algorithm. Using functions like intersectCube and intersectCubes, sediment boundaries are identified and incorporated into the mesh.\par

\subsection{Modelling of Space}

The spatial model is constructed using the backgroundMesh object, which generates a hierarchical data structure (backgroundBlocks\_) to store individual blocks of the domain. Key steps in this process include:\par

\begin{enumerate}
	\item  \textbf{Vertex Creation}: Eight vertices for each block are created using the createVertices function.\par
	\item  \textbf{Dynamic Allocation}: The createListPointers function dynamically allocates memory for the hierarchical block structure.\par
	\item  \textbf{Point Location}: The algorithm identifies which block a given point belongs to using getBlockIndexContainingPoint.\par
\end{enumerate}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]{Figures/Chapters/C05/background_mesh.png}
	\caption{A typical backgroundMesh having $10\times 10\times 10$ regular hexahedral backgroundBlocks representing computational mesh}
	\label{fig:A typical backgroundMesh}
\end{figure}

\subsection{Modelling of Sediments}

Sediments are modelled as discrete aggregates represented by the cubeAggregate and cubeAggregates classes. Each sediment aggregate is defined by:\par

\begin{enumerate}
	\item  \textbf{Geometry}: Local and global point fields (localPoints\_ and globalPoints\_) describe the sediment's shape.\par
	\item  \textbf{Boundary Representation}: The pointList points\_ and the faceList faces\_ and  provides a detailed geometry using quadrilateral face elements derived from functions like createQuadFaces.\par
\end{enumerate}

The sediments are introduced into the flow domain using a particle size distribution (PSD) to control size variation. The cubeAggregates class generates sediment particles with attributes like size and orientation, leveraging functions such as:\par

\begin{enumerate}
	\item  generateAggregates: Generates sediment aggregates of varying sizes and orientations.\par
	\item  translate and rotate: Apply spatial transformations to position and orient sediments within the flow domain.\par
	\item  locate: Determines the precise placement of the sediment within the computational grid.\par
\end{enumerate}

These aggregates are then intersected with the background mesh using the intersectCube method, which identifies and incorporates sediment geometry into the fluid mesh.\par

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.4\textwidth]{Figures/Chapters/C05/single_cube_sediment.png}
	\caption{Modelling of sediment using a cube geometry}
	\label{fig:Modelling of sediment using a cube geometry}
\end{figure}

\subsection{Geometry Intersection}

Geometry intersection ensures integration of sediment geometry into the computational domain as solid boundaries. The focus is on detecting and resolving interactions between complex surfaces, such as aggregates and the background block, to ensure accurate physical representation in sediment flow modeling. Key components include methods for surface intersection detection, cut face generation, and data merging for intersected geometries.\par

\begin{enumerate}
	\item  \textbf{Bounding Box Matching}: Each sediment's bounding box (getBoundBox) is mapped to the corresponding blocks in the computational domain.\par
	\item  \textbf{Closed Surface Intersections}: The sediment's boundary faces are checked for intersections with the domain grid.\par
	\item  \textbf{Dynamic Updates}: The mesh dynamically adapts by updating vertices, faces, and cells based on sediment geometry.\par
\end{enumerate}

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]{Figures/Chapters/C05/immersed_boundary.png}
	\caption{Development of immersed boundary of particle}
	\label{fig:Development of immersed boundary of particle}
\end{figure}

\subsubsection{Intersection with Closed Surfaces}

The intersectClosedSurface function handles the process of intersecting a cube aggregate's triangulated surface (faces and points) with a backgroundBlock. It identifies intersection points and reconstructs the geometry of the intersected surfaces.\par

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]{Figures/Chapters/C05/cube_intersection.png}
	\caption{Intersection of a cube geometry with background mesh}
	\label{fig:Intersection of a cube geometry with background mesh}
\end{figure}


\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]{Figures/Chapters/C05/multiple_intersections.png}
	\caption{Introduction of multiple immersed boundaries in computational domain representing multiple particles}
	\label{fig:Introduction of multiple immersed boundaries in computational domain representing multiple particles}
\end{figure}

\section{Fluid Phase Modelling}

The fluid phase in the solver is modelled using locally averaged incompressible Navier Stokes equations which are given as follows:\par

U-Equation:\par
\begin{equation}
	\frac{\partial \boldsymbol{\mathrm{U}}}{\partial t}+\mathrm{\nabla }\cdot \left[\boldsymbol{\mathrm{U}}\times \boldsymbol{\mathrm{U}}-{\boldsymbol{\mathrm{v}}}_m\times \boldsymbol{\mathrm{U}}\right]-\nu {\mathrm{\nabla }}^2\boldsymbol{\mathrm{U}}=-\mathrm{\nabla }p
	\label{eqn:5_1}
\end{equation}
\equations{U-Equation for Fluid Phase}

P-Equation:\par
\begin{equation}
	\mathrm{\nabla }\cdot \left[\frac{1}{a}\mathrm{\nabla }p\right]=\mathrm{\nabla }\cdot \left[{\boldsymbol{\mathrm{U}}}^*+{\boldsymbol{\mathrm{v}}}_m\right]
	\label{eqn:5_2}
\end{equation}
\equations{P-Equation for Fluid Phase}

In addition to the momentum and pressure equations, the Volume of Fluid (VOF) method is employed to capture the free surface interface between two immiscible fluids (e.g., air and water). The phase fraction $\alpha$ is governed by the transport equation:

\begin{equation}
	\frac{\partial \alpha}{\partial t} + \nabla \cdot (\mathbf{U} \alpha) + \nabla \cdot (\mathbf{U}_r \alpha (1-\alpha)) = 0
	\label{eqn:alpha_eqn}
\end{equation}
\equations{VOF Phase Fraction Equation}

where $\mathbf{U}_r$ is the relative compression velocity used to sharpen the interface. The physical properties of the fluid mixture, such as density $\rho$ and viscosity $\mu$, are calculated as weighted averages:
\begin{equation}
	\rho = \alpha \rho_1 + (1-\alpha) \rho_2
\end{equation}
\begin{equation}
	\mu = \alpha \mu_1 + (1-\alpha) \mu_2
\end{equation}

PIMPLE solver implemented on OpenFOAM solves momentum and pressure equations within each time step, ensuring numerical stability and convergence, especially for cases involving complex geometries or high Reynolds numbers.\par

\section{Lagrangian Mechanics and Discrete Element Method }

The governing equation for particle motion is given as:\par

Newton's second law of motion:\par
\begin{equation}
	m_i\frac{d^2{\boldsymbol{x}}_{\boldsymbol{i}}}{dt^2}={\boldsymbol{F}}^{\boldsymbol{g}}_{\boldsymbol{i}}+{\boldsymbol{F}}^{\boldsymbol{f}}_{\boldsymbol{i}}
	\label{eqn:5_3}
\end{equation}
\equations{Newton's Second Law for Particle Motion}

The velocity and position of the particle is updated using the equation:\par
\begin{equation}
	{\boldsymbol{v}}_{\boldsymbol{i}\boldsymbol{,\ \ }\boldsymbol{t}}={\boldsymbol{v}}_{\boldsymbol{i},\boldsymbol{t}\boldsymbol{-}\boldsymbol{1}}+{\boldsymbol{a}}_{\boldsymbol{i},\boldsymbol{t}}\cdot t
	\label{eqn:5_4}
\end{equation}
\equations{Particle Velocity Update}
\begin{equation}
	{\boldsymbol{x}}_{\boldsymbol{i}\boldsymbol{,\ \ }\boldsymbol{t}}={\boldsymbol{x}}_{\boldsymbol{i},\boldsymbol{t}\boldsymbol{-}\boldsymbol{1}}+{\boldsymbol{v}}_{\boldsymbol{i},\boldsymbol{t}}\cdot t
	\label{eqn:5_5}
\end{equation}
\equations{Particle Position Update}

\subsection{Contact Force Model}
The interaction between particles is modeled using the Walton-Braun hysteretic spring model, which accounts for energy dissipation through plastic deformation during impact. The normal force $F_n$ is calculated based on the overlap $\delta$ between particles:

\textbf{Loading} ($\delta \ge \delta_{max}$):
\begin{equation}
	F_n = k_1 \delta
\end{equation}

\textbf{Unloading/Reloading} ($\delta < \delta_{max}$):
\begin{equation}
	F_n = k_2 (\delta - \delta_0)
\end{equation}
where $k_1$ is the loading stiffness, $k_2$ is the unloading stiffness, and $\delta_0$ is the residual overlap defined as $\delta_0 = \delta_{max} (1 - k_1/k_2)$. The effective coefficient of restitution is given by $e = \sqrt{k_1/k_2}$.

A viscous damping force is also applied to stabilize the contact:
\begin{equation}
	F_{d,n} = -\gamma_n v_{rel,n}
\end{equation}

Tangential forces are modeled using a linear spring-dashpot system limited by Coulomb friction:
\begin{equation}
	F_t = \min \left( |k_t \xi - \gamma_t v_{rel,t}|, \mu F_n \right)
\end{equation}
where $\xi$ is the tangential displacement integration.

\section{CFD -- DEM Coupling}

\subsection{One Way Coupling}

In the implemented one-way coupling framework, the motion of discrete particles is influenced by forces from both the fluid phase and gravity, while the particles do not exert any feedback on the fluid flow.\par

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.6\textwidth]{Figures/Chapters/C05/fluid_pressure.png}
	\caption{Pressure force acting on the Sediment particle under Fluid Flow Domain}
	\label{fig:Pressure force acting on the Sediment particle under Fluid Flow Domain}
\end{figure}


In this approach, the CFD simulation computes the fluid flow field using a Eulerian framework, while the particles are tracked individually in a Eulerian-Lagrangian framework. The fluid forces are interpolated to the particle positions, ensuring accurate representation of the interaction between the fluid and the discrete particles.

\subsection{Immersed Boundary Method (IBM) Implementation}
The coupling is realized through a Fictitious Domain method where the solid particles are mapped onto the Eulerian grid using a solid volume fraction field $\epsilon$.
\begin{equation}
	\epsilon_{cell} = 
	\begin{cases} 
		1 & \text{if cell center is inside particle} \\
		0 & \text{otherwise}
	\end{cases}
\end{equation}

The solid velocity field $\mathbf{U}_{solid}$ is constructed in the cells occupied by particles:
\begin{equation}
	\mathbf{U}_{solid} = \mathbf{v}_p + \boldsymbol{\omega}_p \times \mathbf{r}
\end{equation}
where $\mathbf{v}_p$ is the particle translational velocity, $\boldsymbol{\omega}_p$ is the angular velocity, and $\mathbf{r}$ is the distance vector from the particle center to the cell center.

The fluid-to-particle force is calculated by integrating the pressure gradient over the particle volume:
\begin{equation}
	\mathbf{F}_{fluid \to particle} = \sum_{cells} (-\nabla p)_{cell} V_{cell} \epsilon_{cell}
\end{equation}

\subsection{Flow Field Mapping at successive time interval}

Mapping the flow field (pressure and velocity) from the previous time step's mesh to the current one is performed using interpolation techniques, where the flow variables from the old mesh are projected onto the new mesh based on spatial proximity or weighted averages. Additionally, boundary conditions like the no-slip condition are enforced during mapping to ensure that the fluid velocity matches the solid particle velocities at the fluid-solid interface. This coupling ensures the physical fidelity of the simulation by maintaining consistency in fluid-particle interactions and avoiding artifacts like spurious velocity or pressure fields caused by the mesh evolution.\par
